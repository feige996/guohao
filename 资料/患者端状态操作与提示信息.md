# 患者端各状态操作与提示信息设计

> 基于问诊订单状态码全局定义，详细说明每个状态下患者可进行的操作、提示信息和交互设计

## 📐 页面结构说明

### 两个核心页面

#### 1. 问诊记录列表页
- **功能定位**: 快速浏览和操作
- **展示内容**: 必要信息（状态、医生、时间、金额等）
- **操作按钮**: 核心操作 + 查看详情
- **设计原则**: 简洁、高效、一目了然

#### 2. 问诊详情页
- **功能定位**: 完整信息展示
- **展示内容**: 所有相关信息（完整病历、诊断、处方等）
- **操作按钮**: 所有可能的操作
- **设计原则**: 详尽、完整、可追溯

### 通用规则

- ✅ **所有状态**都有**查看详情**按钮（进入详情页）
- ✅ **进行中(401)**显示**继续问诊**按钮（进入IM界面）
- ✅ **已完成(900)**显示**查看记录**按钮（进入IM界面，只读模式）

---

##  状态分类概览

| 分类 | 状态码范围 | 说明 | 数量 |
|------|-----------|------|------|
| **支付相关** | 1xx | 订单支付流程状态 | 3个 |
| **派单模式** | 2xx | 派单模式专属状态 | 3个 |
| **坐诊模式** | 3xx | 坐诊模式专属状态 | 6个 |
| **问诊服务** | 4xx | 通用问诊服务状态 | 3个 |
| **退款流程** | 5xx | 退款相关状态 | 4个 |
| **终止状态** | 9xx | 订单结束状态 | 3个 |

**总计**: 23个状态码

---

## 1 1xx: 支付相关状态

### 100 - 待支付 (PENDING_PAYMENT)

**状态文本**: `等待支付`

**提示信息**: `请在30分钟内完成支付，超时订单将自动取消`

**可用操作**:
-  **去支付** - 主要操作，跳转支付页面
-  **取消订单** - 次要操作，取消订单无需退款

**按钮状态**: 启用

**UI元素**:
- 倒计时显示支付剩余时间
- 订单金额突出显示
- 支付方式选择（微信/支付宝）

**超时规则**: 30分钟未支付自动取消

---

### 101 - 支付中 (PAYING)

**状态文本**: `支付处理中`

**提示信息**: `正在确认支付结果，请稍候...`

**可用操作**: 无（等待状态）

**按钮状态**: 禁用

**UI元素**:
- Loading动画
- 禁止用户其他操作
- 防止重复支付

---

### 102 - 支付失败 (PAYMENT_FAILED)

**状态文本**: `支付失败`

**提示信息**: `支付失败，请检查账户余额或更换支付方式后重试`

**可用操作**:
-  **重新支付** - 主要操作，重新发起支付
-  **取消订单** - 次要操作

**按钮状态**: 启用

**失败原因**:
- 余额不足
- 银行卡限额
- 网络异常
- 支付超时

---

## 2 2xx: 派单模式专属状态

### 200 - 派单中 (DISPATCHING)

**状态文本**: `正在派单`

**提示信息**: `系统正在为您匹配合适的医生，请稍候...`

**可用操作**:
-  **申请退款** - 次要操作，全额退款

**按钮状态**: 启用

**UI元素**:
- 派单进度动画
- 匹配条件说明（科室、专业领域）
- 预计等待时间（1-3分钟）

**退款规则**: 100%全额退款

---

### 201 - 待接单 (WAITING_ACCEPT)

**状态文本**: `等待医生接单`

**提示信息**: `已为您分配医生，等待医生确认接诊（预计5分钟内）`

**可用操作**:
-  **查看医生信息** - 查看分配的医生详情
-  **申请退款** - 次要操作，全额退款

**按钮状态**: 启用

**UI元素**:
- 医生头像、姓名、职称
- 接单倒计时（5分钟）
- 医生专业领域标签

**超时规则**: 5分钟未接诊自动重新派单或退款

**退款规则**: 100%全额退款

---

### 202 - 派单失败 (DISPATCH_FAILED)

**状态文本**: `派单失败`

**提示信息**: `暂无可用医生，系统将自动为您全额退款`

**可用操作**:
-  **查看详情** - 查看失败原因和退款进度
-  **重新下单** - 创建新订单

**按钮状态**: 启用

**失败原因**:
- 无在线医生
- 医生全部拒单
- 系统异常

**退款规则**: 100%全额退款，预计1个工作日内到账

---

## 3 3xx: 坐诊模式专属状态

### 300 - 取号中 (TAKING_NUMBER)

**状态文本**: `正在取号`

**提示信息**: `系统正在为您分配排队号码，请稍候...`

**可用操作**: 无（自动流转）

**按钮状态**: 禁用

**UI元素**:
- 取号进度动画
- 医生信息展示
- 诊室信息

---

### 301 - 预约待生效 (APPOINTMENT_PENDING)

**状态文本**: `预约成功`

**提示信息**: `预约成功，医生将在 [开诊时间] 开始接诊`

**可用操作**:
-  **查看医生信息** - 查看预约医生详情
-  **设置提醒** - 开诊前15分钟提醒
-  **申请退款** - 次要操作，全额退款

**按钮状态**: 启用

**UI元素**:
- 预约时间突出显示
- 医生信息卡片
- 诊室号码
- 提醒设置开关

**退款规则**: 100%全额退款

---

### 302 - 排队中 (QUEUING)

**状态文本**: `排队中`

**提示信息**: `您的排队号是 [X]号，前面还有 [N] 位患者，预计等待 [X] 分钟`

**可用操作**:
-  **查看排队进度** - 实时查看队列情况
-  **申请退款** - 次要操作，扣除10%服务费

**按钮状态**: 启用

**UI元素**:
- 排队号码（大号显示）
- 前方人数实时更新
- 预计等待时间
- 当前叫号号码
- 排队进度条

**更新频率**: 每30秒刷新排队信息

**退款规则**: 扣除10%服务费后退款

---

### 303 - 叫号中 (CALLING)

**状态文本**: `医生正在呼叫您`

**提示信息**: `医生正在呼叫您，请尽快进入问诊室（2分钟内）`

**可用操作**:
-  **立即进入** - 主要操作，醒目按钮，闪烁提示
-  **暂时无法接听** - 次要操作，过号重排

**按钮状态**: 启用，闪烁提示

**UI元素**:
- 大号闪烁提示
- 倒计时（2分钟）
- 叫号次数提示（第X次，共3次）

**提醒方式**:
-  APP推送通知
-  页面弹窗提示
-  声音提醒
-  振动提醒

**叫号规则**: 每次等待2分钟，最多3次叫号

---

### 304 - 叫号失败 (CALL_FAILED)

**状态文本**: `叫号失败`

**提示信息**: `您3次未应答医生叫号，系统将扣除20%服务费后退款`

**可用操作**:
-  **查看详情** - 查看退款详情

**按钮状态**: 启用

**UI元素**:
- 失败原因说明
- 扣费明细
- 退款金额
- 退款进度

**退款规则**: 扣除20%服务费，预计3个工作日内到账

---

### 305 - 过号重排 (RECALL_QUEUING)

**状态文本**: `重新排队中`

**提示信息**: `您已过号，系统已为您重新排队，请注意接听下次叫号`

**可用操作**:
-  **查看排队进度** - 查看新的排队位置
-  **申请退款** - 次要操作，扣除15%服务费

**按钮状态**: 启用

**UI元素**:
- 新的排队号码
- 排队位置说明
-  警告提示

**重要提示**:  请保持在线，下次叫号未应答将失败并扣除服务费

**重排规则**: 顺延3位后重新排队

**退款规则**: 扣除15%服务费后退款

---

## 4 4xx: 问诊服务状态（通用）

### 400 - 待接诊 (WAITING_CONSULT)

**状态文本**: `待接诊`

**提示信息**: `医生准备中，即将开始问诊...`

**可用操作**:
-  **查看医生信息** - 查看医生详情
-  **申请退款** - 次要操作，扣除10-20%服务费

**按钮状态**: 启用

**UI元素**:
- 医生准备状态
- 问诊准备提示
- 网络检测
- 设备检测（视频/语音）

**准备检查**:
-  网络连接检测
-  设备权限检查
-  音视频测试

**温馨提示**:
- 请准备好病历资料
- 确保环境安静
- 保持网络畅通

---

### 401 - 进行中 (CONSULTING)

**状态文本**: `问诊进行中`

**提示信息**: `问诊进行中，请与医生保持沟通`

**可用操作**:
-  **继续问诊** - 主要操作，进入问诊界面
-  **上传图片** - 上传症状图片
-  **查看记录** - 查看问诊记录
-  **结束问诊** - 次要操作，提前结束

**按钮状态**: 启用

**UI元素**:
- 问诊时长显示
- 网络状态指示
- 消息未读提示
- 功能快捷入口

**问诊功能**:
-  文字消息
-  图片上传
-  语音通话（语音问诊）
-  视频通话（视频问诊）
-  病历查看
-  处方查看

**网络监控**: 实时显示网络连接质量

---

### 402 - 服务超时 (SERVICE_TIMEOUT)

**状态文本**: `服务即将结束`

**提示信息**: `问诊时长已达上限，系统即将自动结束`

**可用操作**:
-  **查看记录** - 查看问诊记录

**按钮状态**: 启用

**UI元素**:
- 超时提示
- 自动结束倒计时

**自动流转**: 自动转为已完成状态

---

## 5 5xx: 退款相关状态

### 500 - 退款申请中 (REFUND_APPLYING)

**状态文本**: `退款申请中`

**提示信息**: `您的退款申请已提交，系统正在审核...`

**可用操作**:
-  **查看详情** - 查看退款申请详情

**按钮状态**: 启用

**UI元素**:
- 申请时间
- 退款原因
- 预计退款金额
- 审核进度

---

### 501 - 退款审核中 (REFUND_REVIEWING)

**状态文本**: `退款审核中`

**提示信息**: `退款申请审核中，预计1-5分钟完成`

**可用操作**:
-  **查看详情** - 查看审核进度

**按钮状态**: 启用

**UI元素**:
- 审核进度条
- 预计完成时间
- 审核规则说明

**审核内容**:
- 订单状态核验
- 退款比例计算
- 退款金额确认

---

### 502 - 退款处理中 (REFUND_PROCESSING)

**状态文本**: `退款处理中`

**提示信息**: `退款审核通过，预计1-7个工作日退款到账`

**可用操作**:
-  **查看详情** - 查看退款详情

**按钮状态**: 启用

**UI元素**:
- 退款金额
- 退款方式（原路退回）
- 预计到账时间
- 退款进度

**退款渠道**: 原路退回（微信/支付宝）

---

### 503 - 退款失败 (REFUND_FAILED)

**状态文本**: `退款失败`

**提示信息**: `退款处理失败，系统将自动重试或转人工处理`

**可用操作**:
-  **联系客服** - 主要操作，联系客服处理
-  **查看详情** - 查看失败原因

**按钮状态**: 启用

**失败原因**:
- 支付网关异常
- 账户信息错误
- 银行卡状态异常

**处理方式**: 自动重试3次，失败后转人工

---

## 9 9xx: 终止状态

### 900 - 已完成 (COMPLETED)

**状态文本**: `已完成`

**提示信息**: `问诊已结束，感谢您的使用`

**可用操作**:
-  **评价医生** - 主要操作（未评价时突出显示）
-  **查看记录** - 查看完整问诊记录
-  **查看处方** - 查看处方详情（如有）
-  **再次咨询** - 快速创建新订单

**按钮状态**: 启用

**显示内容**:
- 问诊时长
- 诊断结果
- 治疗建议
- 处方信息
- 评价入口（未评价时突出显示）

---

### 901 - 已退款 (REFUNDED)

**状态文本**: `已退款`

**提示信息**: `退款已完成，款项已原路退回`

**可用操作**:
-  **查看详情** - 查看退款详情
-  **重新下单** - 创建新订单

**按钮状态**: 启用

**退款信息**:
- 退款金额
- 退款时间
- 退款原因
- 退款方式

---

### 902 - 已取消 (CANCELLED)

**状态文本**: `已取消`

**提示信息**: `订单已取消`

**可用操作**:
-  **查看详情** - 查看取消原因
-  **重新下单** - 创建新订单

**按钮状态**: 启用

**取消信息**:
- 取消时间
- 取消原因（用户取消/超时取消/系统取消）

---

## 📱 两个页面的操作按钮设计

### 按钮设计原则

| 页面 | 按钮类型 | 设计原则 |
|------|---------|---------|
| **问诊记录列表** | 核心操作 + 查看详情 | 最多2个主要操作按钮 + 1个详情按钮 |
| **问诊详情页** | 所有可能操作 | 完整展示所有操作选项 |

---

### 各状态按钮配置表

| 状态码 | 状态名称 | 列表页按钮 | 详情页按钮 |
|--------|---------|-----------|-----------|
| **100** | 待支付 | • 去支付<br>• 查看详情 | • 去支付<br>• 取消订单<br>• 查看订单信息 |
| **101** | 支付中 | • 查看详情 | • 查看支付进度<br>• 查看订单信息 |
| **102** | 支付失败 | • 重新支付<br>• 查看详情 | • 重新支付<br>• 取消订单<br>• 查看失败原因<br>• 更换支付方式 |
| **200** | 派单中 | • 查看详情 | • 查看派单进度<br>• 申请退款<br>• 查看订单信息 |
| **201** | 待接单 | • 查看医生<br>• 查看详情 | • 查看医生信息<br>• 申请退款<br>• 查看订单信息 |
| **202** | 派单失败 | • 重新下单<br>• 查看详情 | • 查看失败原因<br>• 查看退款进度<br>• 重新下单 |
| **300** | 取号中 | • 查看详情 | • 查看取号进度<br>• 查看医生信息<br>• 查看订单信息 |
| **301** | 预约待生效 | • 设置提醒<br>• 查看详情 | • 查看预约信息<br>• 设置提醒<br>• 申请退款<br>• 查看医生信息 |
| **302** | 排队中 | • 查看排队<br>• 查看详情 | • 查看排队进度<br>• 申请退款<br>• 查看医生信息<br>• 查看订单信息 |
| **303** | 叫号中 | • **立即进入**<br>• 查看详情 | • **立即进入**<br>• 暂时无法接听<br>• 查看叫号信息<br>• 查看医生信息 |
| **304** | 叫号失败 | • 查看详情 | • 查看失败原因<br>• 查看退款详情<br>• 重新下单 |
| **305** | 过号重排 | • 查看排队<br>• 查看详情 | • 查看新排队位置<br>• 申请退款<br>• 查看医生信息<br>• 查看订单信息 |
| **400** | 待接诊 | • 查看详情 | • 查看医生信息<br>• 申请退款<br>• 查看订单信息<br>• 设备检测 |
| **401** | 进行中 | • **继续问诊**（IM）<br>• 查看详情 | • **继续问诊**（IM）<br>• 上传图片<br>• 结束问诊<br>• 查看医生信息 |
| **402** | 服务超时 | • 查看详情 | • 查看问诊记录<br>• 查看医生信息<br>• 查看订单信息 |
| **500** | 退款申请中 | • 查看详情 | • 查看退款申请<br>• 查看申请进度<br>• 查看订单信息 |
| **501** | 退款审核中 | • 查看详情 | • 查看审核进度<br>• 查看退款信息<br>• 查看订单信息 |
| **502** | 退款处理中 | • 查看详情 | • 查看退款进度<br>• 查看退款信息<br>• 查看订单信息 |
| **503** | 退款失败 | • 联系客服<br>• 查看详情 | • 联系客服<br>• 查看失败原因<br>• 查看订单信息<br>• 重试退款 |
| **900** | 已完成 | • **查看记录**（IM只读）<br>• 查看详情 | • **查看记录**（IM只读）<br>• 评价医生<br>• 查看处方<br>• 再次咨询<br>• 查看完整病历 |
| **901** | 已退款 | • 重新下单<br>• 查看详情 | • 查看退款详情<br>• 重新下单<br>• 查看订单信息 |
| **902** | 已取消 | • 重新下单<br>• 查看详情 | • 查看取消原因<br>• 重新下单<br>• 查看订单信息 |

---

### 特殊说明

#### 1. IM界面入口
- **401 进行中**: "继续问诊" → 进入IM界面（可编辑、可发送）
- **900 已完成**: "查看记录" → 进入IM界面（只读模式、不可发送）

#### 2. 查看详情按钮
- **所有状态**都必须有"查看详情"按钮
- 点击后进入问诊详情页
- 详情页展示完整信息和所有操作

#### 3. 列表页按钮数量限制
- **主要操作**: 最多1-2个（如"去支付"、"继续问诊"）
- **查看详情**: 必有1个
- **总计**: 不超过3个按钮，保持界面简洁

#### 4. 详情页按钮分组
建议按功能分组展示：
- **核心操作区**: 主要操作按钮（大按钮）
- **辅助功能区**: 次要操作（中等按钮）
- **信息查看区**: 查看类操作（小按钮或链接）

---

## 📱 前端简化Tab映射

根据状态码定义，前端简化为4个Tab，便于用户查看和管理订单：

| Tab名称 | 包含状态码 | 状态数量 | 主要操作 |
|---------|-----------|---------|---------|
| **待支付** | 100, 101, 102 | 3个 | 去支付、重新支付 |
| **待服务** | 200, 201, 300, 301, 302, 303, 305, 400 | 8个 | 等待中、查看进度、申请退款 |
| **服务中** | 401, 402 | 2个 | 继续问诊、上传资料 |
| **已完成** | 900, 901, 902, 202, 304, 5xx | 10个 | 查看记录、评价、查看退款 |

### Tab详细说明

#### Tab 1: 待支付
- **状态**: 100, 101, 102
- **特点**: 支付流程相关，需要用户完成支付操作
- **主要操作**: 去支付、重新支付、取消订单
- **排序**: 按创建时间倒序

#### Tab 2: 待服务
- **状态**: 200, 201, 300, 301, 302, 303, 305, 400
- **特点**: 已支付但服务未开始，包括派单、排队、叫号等待状态
- **主要操作**: 查看进度、申请退款、进入问诊
- **排序**: 按状态优先级排序（叫号中 > 排队中 > 待接单 > 其他）

#### Tab 3: 服务中
- **状态**: 401, 402
- **特点**: 问诊服务正在进行中
- **主要操作**: 继续问诊、上传资料、查看记录
- **排序**: 按开始时间倒序
- **特殊标识**: 显示问诊时长、网络状态

#### Tab 4: 已完成
- **状态**: 900, 901, 902, 202, 304, 5xx
- **特点**: 订单已结束（完成/退款/取消）
- **主要操作**: 查看记录、评价、查看退款、重新下单
- **排序**: 按完成时间倒序
- **特殊标识**: 未评价订单突出显示

---

##  交互设计建议

### 1. 按钮设计规范

#### 按钮优先级

| 优先级 | 样式 | 使用场景 | 示例 |
|--------|------|---------|------|
| **主要操作** | 主题色按钮，大尺寸 | 用户最常用的核心操作 | 去支付、继续问诊、立即进入 |
| **次要操作** | 次要色或边框按钮，中等尺寸 | 辅助功能 | 查看详情、申请退款 |
| **危险操作** | 警告色，需二次确认 | 不可逆操作 | 取消订单、结束问诊 |

#### 按钮状态

- **启用**: 正常可点击，有交互反馈
- **禁用**: 灰色显示，不可点击
- **加载中**: 显示loading动画，防止重复点击
- **闪烁**: 紧急操作提示（如叫号中）

---

### 2. 状态提示设计

#### 提示类型

| 提示类型 | 使用场景 | 视觉效果 |
|---------|---------|---------|
| **等待状态** | 派单中、取号中、支付中 | Loading动画 + 文字说明 |
| **叫号状态** | 医生呼叫患者 | 闪烁提示 + 声音 + 振动 |
| **超时警告** | 支付倒计时、叫号倒计时 | 红色倒计时 + 警告图标 |
| **成功状态** | 支付成功、问诊完成 | 绿色图标 + 成功提示 |
| **失败状态** | 支付失败、派单失败 | 红色图标 + 失败原因 |

#### 颜色规范

-  **成功/进行中**: 绿色 `#52c41a`
-  **等待/警告**: 黄色 `#faad14`
-  **失败/紧急**: 红色 `#f5222d`
-  **信息/提示**: 蓝色 `#1890ff`
-  **已完成/中性**: 灰色 `#8c8c8c`

---

### 3. 实时更新策略

| 状态类型 | 更新频率 | 更新方式 |
|---------|---------|---------|
| **排队状态** | 每30秒 | 轮询刷新 |
| **叫号状态** | 实时 | WebSocket推送 |
| **退款状态** | 每分钟 | 轮询查询 |
| **问诊状态** | 实时 | WebSocket推送 |
| **支付状态** | 每5秒 | 轮询查询（支付中） |

---

### 4. 用户引导设计

#### 引导时机

- **首次使用**: 显示操作引导
- **关键节点**: 弹窗提示（如叫号时）
- **异常情况**: 明确告知原因和解决方案

#### 引导内容

- **操作说明**: 清晰的步骤指引
- **注意事项**: 重要提示突出显示
- **帮助入口**: 提供客服联系方式

---

### 5. 消息通知设计

#### 通知优先级

| 优先级 | 通知方式 | 使用场景 |
|--------|---------|---------|
| **紧急** | APP推送 + 短信 + 声音 + 振动 | 叫号中 |
| **重要** | APP推送 + 页面弹窗 | 医生接单、支付成功 |
| **普通** | APP推送 | 排队进度更新 |
| **提示** | 页面内提示 | 一般信息更新 |

---

##  状态流转可视化

### 派单模式流程

```
待支付(100)  支付中(101)  派单中(200)  待接单(201)  待接诊(400)  进行中(401)  已完成(900)
                                                                           
  取消(902)    失败(102)      失败(202)      退款(5xx)      退款(5xx)      超时(402)
```

### 坐诊模式流程

```
待支付(100)  支付中(101)  取号中(300)  预约待生效(301)  排队中(302)  叫号中(303)  待接诊(400)  进行中(401)  已完成(900)
                                                                                                       
  取消(902)    失败(102)      退款(5xx)      退款(5xx)      退款(5xx)   过号重排(305)   退款(5xx)      超时(402)
                                                                           
                                                                      叫号失败(304)
```

---

##  实施建议

### 1. 开发优先级
- **P0**: 核心流程状态（100, 200, 201, 400, 401, 900）
- **P1**: 异常处理状态（102, 202, 5xx）
- **P2**: 坐诊特殊状态（302, 303, 304, 305）

### 2. 测试重点
- 状态流转正确性
- 按钮可用性逻辑
- 实时更新准确性
- 异常情况处理

### 3. 性能优化
- 使用虚拟滚动处理大量订单列表
- 图片懒加载
- 合理使用缓存减少请求
- WebSocket连接管理

---

## 🎨 页面布局示例

### 问诊记录列表页布局

```
┌─────────────────────────────────────┐
│  问诊记录                            │
│  [待支付] [待服务] [服务中] [已完成]  │
├─────────────────────────────────────┤
│                                     │
│  ┌───────────────────────────────┐ │
│  │ 🟢 进行中                      │ │
│  │ 王医生 · 主任医师              │ │
│  │ 文字问诊 · 已问诊 12分钟       │ │
│  │ ¥99.00                        │ │
│  │                               │ │
│  │ [  继续问诊  ] [ 查看详情 ]    │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ 🟡 排队中                      │ │
│  │ 李医生 · 副主任医师            │ │
│  │ 排队号：08号 · 前方3人         │ │
│  │ ¥189.00                       │ │
│  │                               │ │
│  │ [ 查看排队 ] [ 查看详情 ]      │ │
│  └───────────────────────────────┘ │
│                                     │
│  ┌───────────────────────────────┐ │
│  │ ⚪ 已完成                      │ │
│  │ 张医生 · 主治医师              │ │
│  │ 2024-11-15 14:30 · 已评价     │ │
│  │ ¥99.00                        │ │
│  │                               │ │
│  │ [ 查看记录 ] [ 查看详情 ]      │ │
│  └───────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

### 问诊详情页布局（以"进行中"为例）

```
┌─────────────────────────────────────┐
│  ← 问诊详情                          │
├─────────────────────────────────────┤
│                                     │
│  【状态信息】                        │
│  🟢 问诊进行中                       │
│  已问诊时长：12分35秒                │
│  网络状态：良好                      │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  【医生信息】                        │
│  [头像] 王医生                       │
│        主任医师 · 中医内科           │
│        擅长：脾胃调理、失眠调理      │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  【订单信息】                        │
│  订单编号：APT202411150001          │
│  问诊类型：文字问诊                  │
│  创建时间：2024-11-15 10:30         │
│  支付金额：¥99.00                   │
│  支付方式：微信支付                  │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  【主诉症状】                        │
│  最近感觉身体乏力，有轻微头痛症状... │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  【核心操作】                        │
│  ┌─────────────────────────────┐   │
│  │     继续问诊（进入IM）       │   │
│  └─────────────────────────────┘   │
│                                     │
│  【辅助功能】                        │
│  [ 上传图片 ]  [ 结束问诊 ]         │
│                                     │
│  【信息查看】                        │
│  查看医生详细信息 >                  │
│  查看订单详细信息 >                  │
│                                     │
└─────────────────────────────────────┘
```

### 问诊详情页布局（以"已完成"为例）

```
┌─────────────────────────────────────┐
│  ← 问诊详情                          │
├─────────────────────────────────────┤
│                                     │
│  【状态信息】                        │
│  ✅ 已完成                          │
│  完成时间：2024-11-15 15:30         │
│  问诊时长：25分钟                    │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  【医生信息】                        │
│  [头像] 王医生                       │
│        主任医师 · 中医内科           │
│        ⭐⭐⭐⭐⭐ 5.0               │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  【诊断结果】                        │
│  脾胃虚弱，运化失常                  │
│                                     │
│  【治疗建议】                        │
│  健脾和胃，理气消食。建议清淡饮食... │
│                                     │
│  【处方信息】                        │
│  💊 已开具处方                      │
│  [查看处方详情 >]                    │
│                                     │
│  ─────────────────────────────────  │
│                                     │
│  【核心操作】                        │
│  ┌─────────────────────────────┐   │
│  │   查看记录（进入IM只读）     │   │
│  └─────────────────────────────┘   │
│                                     │
│  【辅助功能】                        │
│  [ ⭐ 评价医生 ]  [ 再次咨询 ]      │
│                                     │
│  【信息查看】                        │
│  查看完整病历 >                      │
│  查看处方详情 >                      │
│  查看医生详细信息 >                  │
│  查看订单详细信息 >                  │
│                                     │
└─────────────────────────────────────┘
```

---

## 🔄 IM界面模式说明

### 1. 进行中状态 - IM可编辑模式

**入口**: 列表页或详情页点击"继续问诊"

**功能特性**:
- ✅ 可发送文字消息
- ✅ 可上传图片
- ✅ 可发起语音/视频（对应问诊类型）
- ✅ 实时接收医生消息
- ✅ 显示问诊时长
- ✅ 显示网络状态

**界面元素**:
```
┌─────────────────────────────────────┐
│  ← 王医生                            │
│  主任医师 · 在线 · 已问诊 12:35     │
├─────────────────────────────────────┤
│                                     │
│  【聊天记录区域】                    │
│                                     │
│  患者: 医生您好，我最近...          │
│  10:30                              │
│                                     │
│  医生: 您好，请详细描述...          │
│  10:32                              │
│                                     │
│  ...                                │
│                                     │
├─────────────────────────────────────┤
│  [📷] [输入框...] [发送]            │
└─────────────────────────────────────┘
```

### 2. 已完成状态 - IM只读模式

**入口**: 列表页或详情页点击"查看记录"

**功能特性**:
- ✅ 查看完整聊天记录
- ✅ 查看图片附件
- ✅ 查看诊断和处方
- ❌ 不可发送新消息
- ❌ 不可上传新图片

**界面元素**:
```
┌─────────────────────────────────────┐
│  ← 问诊记录                          │
│  王医生 · 2024-11-15 · 已完成       │
├─────────────────────────────────────┤
│                                     │
│  【聊天记录区域 - 只读】             │
│                                     │
│  患者: 医生您好，我最近...          │
│  10:30                              │
│                                     │
│  医生: 您好，请详细描述...          │
│  10:32                              │
│                                     │
│  ...                                │
│                                     │
│  【诊断结果】                        │
│  脾胃虚弱，运化失常                  │
│                                     │
│  【治疗建议】                        │
│  健脾和胃，理气消食...              │
│                                     │
│  【处方】                            │
│  [查看处方详情]                      │
│                                     │
├─────────────────────────────────────┤
│  问诊已结束，如需继续咨询请重新下单  │
└─────────────────────────────────────┘
```

---

**文档版本**: v1.1  
**最后更新**: 2024-11-17  
**维护者**: 产品 & 技术团队
