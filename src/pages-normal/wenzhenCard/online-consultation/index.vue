<script setup lang="ts">
// åœ¨çº¿é—®è¯Šç»„ä»¶
import type { DoctorCardConfig } from '@/components/DoctorCard'
import { ref } from 'vue'

// é¡µé¢é…ç½®
definePage({
  style: {
    navigationStyle: 'custom',
    navigationBarTitleText: 'åœ¨çº¿é—®è¯Š',
  },
})

// æœç´¢å…³é”®è¯
const searchKeyword = ref('')

// ç­›é€‰æ¡ä»¶
const activeFilters = ref({
  department: 'å…¨éƒ¨',
  condition: 'å…¨éƒ¨',
  price: 'å…¨éƒ¨',
  experience: 'å…¨éƒ¨',
  therapy: 'å…¨éƒ¨',
})

// æ¨¡æ‹ŸåŒ»ç”Ÿæ•°æ®
const doctors = ref<DoctorCardConfig[]>([
  {
    id: '1',
    name: 'æŸ´å¾·å»º',
    title: 'ä¸»æ²»åŒ»å¸ˆ',
    department: ['ä¸­åŒ»å…¨ç§‘', 'ä¸­åŒ»å†…ç§‘'],
    hospital: 'å¤©æ´¥ä¸­åŒ»è¯å¤§å­¦é™„å±åŒ»é™¢',
    consultationCount: 1234,
    rating: 99.1,
    specialty: 'æ¯•ä¸šäºå¤©æ´¥ä¸­åŒ»è¯å¤§å­¦ï¼Œå¸ˆä»å¤©æ´¥ä¸­åŒ»è¯å¤§å­¦ç”°éœ¸æ•™æˆï¼Œæ—¢å¾€ä»äº‹ä¸­åŒ»ä¸´åºŠå·¥ä½œåä½™å¹´',
    avatar: 'https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?w=400&h=400&fit=crop&crop=center',
  },
  {
    id: '2',
    name: 'ææ–°æ°‘',
    title: 'å‰¯ä¸»ä»»åŒ»å¸ˆ',
    department: ['ä¸­åŒ»å†…ç§‘', 'é«˜è¡€å‹'],
    hospital: 'ä»å¿ƒåŒ»é™¢',
    consultationCount: 818,
    rating: 99.5,
    specialty: 'æ±‰æ—ï¼Œä¸­å…±å…šå‘˜ï¼Œä»å¿ƒåŒ»é™¢å‰¯é™¢é•¿ï¼Œæ¯•ä¸šäºä¸­å›½äººæ°‘è§£æ”¾å†›ç¬¬ä¸€å†›åŒ»å¤§å­¦',
    avatar: 'https://images.unsplash.com/photo-1607990281513-2c110a25bd8c?w=400&h=400&fit=crop&crop=center',
  },
  {
    id: '3',
    name: 'éŸ©å›½åˆš',
    title: 'ä¸»ä»»åŒ»å¸ˆ',
    department: ['å† å¿ƒç—…', 'ä¸­åŒ»å…¨ç§‘'],
    hospital: 'å›½æµ©ä¸­åŒ»åŒ»é™¢',
    consultationCount: 937,
    rating: 99.1,
    specialty: 'ä»äº‹ä¸­åŒ»ä¸´åºŠå·¥ä½œ20ä½™å¹´ï¼Œæ“…é•¿æ²»ç–—å„ç±»å¿ƒè¡€ç®¡ç–¾ç—…ï¼Œå°¤å…¶åœ¨å† å¿ƒç—…é¢†åŸŸæœ‰æ·±å…¥ç ”ç©¶',
    avatar: 'https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?w=400&h=400&fit=crop&crop=center',
  },
])

// ç­›é€‰é€‰é¡¹æ•°æ®
const filterOptions = {
  department: ['å…¨éƒ¨', 'å†…ç§‘', 'å¤–ç§‘', 'å¦‡ç§‘', 'å„¿ç§‘', 'ä¸­åŒ»ç§‘', 'åº·å¤ç§‘'],
  condition: ['å…¨éƒ¨', 'é«˜è¡€å‹', 'ç³–å°¿ç—…', 'å† å¿ƒç—…', 'æ„Ÿå†’', 'èƒƒç‚', 'å…³èŠ‚ç‚'],
  price: ['å…¨éƒ¨', '100å…ƒä»¥ä¸‹', '100-200å…ƒ', '200-500å…ƒ', '500å…ƒä»¥ä¸Š'],
  experience: ['å…¨éƒ¨', '5å¹´ä»¥ä¸‹', '5-10å¹´', '10-20å¹´', '20å¹´ä»¥ä¸Š'],
  therapy: ['å…¨éƒ¨', 'ä¸­è¯è°ƒç†', 'é’ˆç¸æ¨æ‹¿', 'ä¸­è¥¿åŒ»ç»“åˆ', 'è‰¾ç¸ç–—æ³•'],
}

// å¤„ç†æœç´¢
function handleSearch() {
  console.log('æœç´¢åŒ»ç”Ÿ:', searchKeyword.value)
  // è¿™é‡Œå¯ä»¥æ·»åŠ æœç´¢é€»è¾‘
}

// å¤„ç†ç­›é€‰
function handleFilter(type: string, value: string) {
  activeFilters.value[type as keyof typeof activeFilters.value] = value
  console.log('ç­›é€‰æ¡ä»¶:', type, value)
  // è¿™é‡Œå¯ä»¥æ·»åŠ ç­›é€‰é€»è¾‘
}

// å¤„ç†åŒ»ç”Ÿå¡ç‰‡ç‚¹å‡»
function handleDoctorClick(doctor: DoctorCardConfig) {
  console.log('ç‚¹å‡»åŒ»ç”Ÿ:', doctor.name)
  // è¿™é‡Œå¯ä»¥æ·»åŠ è·³è½¬åˆ°åŒ»ç”Ÿè¯¦æƒ…é¡µçš„é€»è¾‘
  uni.showToast({
    title: `ç‚¹å‡»äº†${doctor.name}åŒ»ç”Ÿ`,
    icon: 'none',
  })
}

// å¤„ç†å’¨è¯¢æŒ‰é’®ç‚¹å‡»
function handleConsultClick(doctorId: string) {
  console.log('ç«‹å³å’¨è¯¢:', doctorId)
  // è·³è½¬åˆ°é—®è¯Šé¢„çº¦é¡µé¢
  uni.navigateTo({
    url: `/pages-normal/wenzhenCard/online-consultation/appointment?id=${doctorId}`,
    success: () => console.log('è·³è½¬é—®è¯Šé¢„çº¦é¡µé¢æˆåŠŸ'),
    fail: (err) => console.error('è·³è½¬é—®è¯Šé¢„çº¦é¡µé¢å¤±è´¥:', err)
  })
}

// å…³é—­å¼¹çª—
function handleClose() {
  console.log('å…³é—­åœ¨çº¿é—®è¯Šå¼¹çª—')
  // è¿™é‡Œå¯ä»¥æ·»åŠ å…³é—­å¼¹çª—çš„é€»è¾‘
  uni.navigateBack()
}

// è¾…åŠ©å‡½æ•°
function getFilterLabel(type: string): string {
  const labels: Record<string, string> = {
    department: 'æŒ‰ç§‘å®¤',
    condition: 'æŒ‰ç–¾ç—…',
    price: 'æŒ‰è¯„ä»·',
    experience: 'ä»åŒ»å¹´é™',
    therapy: 'æ“…é•¿ç–—æ³•',
  }
  return labels[type] || type
}
</script>

<template>
  <view class="rounded-[16rpx] bg-white p-4">
    <!-- æ ‡é¢˜æ  -->
    <view class="mb-4 flex items-center justify-between">
      <text class="text-[#333] font-medium text-[32rpx]">åœ¨çº¿é—®è¯Š</text>
      <view class="h-8 w-8 flex items-center justify-center" @click="handleClose">
        <text class="text-[#999] text-[40rpx]">âœ•</text>
      </view>
    </view>

    <!-- æœç´¢æ  -->
    <view class="mb-4 flex items-center rounded-[8rpx] bg-[#f5f5f5] px-3 py-2">
      <text class="mr-2 text-[#999]">ğŸ”</text>
      <input
        v-model="searchKeyword"
        type="text"
        placeholder="æœç´¢åŒ»ç”Ÿã€åŒ»å¸ˆå§“åæœç´¢"
        placeholder-style="color:#999; font-size:28rpx"
        class="flex-1 bg-transparent text-[28rpx]"
        @confirm="handleSearch"
      >
      <text class="text-[#8c2303] text-[28rpx]" @click="handleSearch">æœç´¢</text>
    </view>

    <!-- ç­›é€‰æ  -->
    <view class="mb-4 flex overflow-x-auto pb-2">
      <view
        v-for="(options, type) in filterOptions"
        :key="type"
        class="mr-4 flex-shrink-0"
      >
        <view class="flex items-center">
          <text class="mr-2 text-[#666] text-[28rpx]">{{ getFilterLabel(type) }}</text>
          <view
            v-for="option in options"
            :key="option"
            class="flex-shrink-0"
          >
            <view
              class="mr-2 rounded-full px-3 py-1 text-[24rpx]"
              :class="[
                activeFilters[type as keyof typeof activeFilters] === option
                  ? 'bg-[#8c2303] text-white'
                  : 'bg-[#f5f5f5] text-[#666]',
              ]"
              @click="handleFilter(type, option)"
            >
              {{ option }}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç­›é€‰æŒ‰é’® -->
    <view class="mb-4 flex items-center justify-end">
      <text class="mr-2 text-[#666] text-[28rpx]">ç­›é€‰</text>
      <text class="text-[#999] text-[24rpx]">â‰¡</text>
    </view>

    <!-- åŒ»ç”Ÿåˆ—è¡¨ -->
    <view class="space-y-4">
      <view
        v-for="doctor in doctors"
        :key="doctor.id"
        class="border border-[#eee] rounded-[8rpx] p-3"
        @click="handleDoctorClick(doctor)"
      >
        <view class="flex items-start">
          <!-- åŒ»ç”Ÿå¤´åƒ -->
          <image
            :src="doctor.avatar"
            class="mr-3 h-20 w-20 flex-shrink-0 rounded-full"
          />

          <!-- åŒ»ç”Ÿä¿¡æ¯ -->
          <view class="flex-1">
            <view class="mb-1 flex items-center">
              <text class="mr-2 text-[#333] font-medium text-[28rpx]">{{ doctor.name }}</text>
              <text class="text-[#666] text-[24rpx]">{{ doctor.title }}</text>
            </view>

            <view class="mb-1 flex flex-wrap">
              <view
                v-for="(dept, index) in doctor.department"
                :key="index"
                class="mb-1 mr-2 rounded-[4rpx] bg-[#f5f5f5] px-2 py-0.5 text-[#666] text-[20rpx]"
              >
                {{ dept }}
              </view>
            </view>

            <text class="mb-2 block line-clamp-2 text-[#999] text-[24rpx]">{{ doctor.specialty }}</text>

            <view class="flex items-center justify-between">
              <view class="flex items-center">
                <text class="text-[#ff6b35] font-medium text-[24rpx]">å¥½è¯„ç‡ {{ doctor.rating }}%</text>
                <text class="ml-3 text-[#999] text-[24rpx]">æ¥è¯Šé‡: {{ doctor.consultationCount }}</text>
              </view>

              <view
                class="rounded-full bg-[#8c2303] px-3 py-0.5 text-white text-[20rpx]"
                @click.stop="handleConsultClick(doctor.id)"
              >
                ç«‹å³å’¨è¯¢
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>
