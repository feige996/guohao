<script setup lang="ts">
// ÈóÆËØäÈ¢ÑÁ∫¶È°µÈù¢
import { onLoad } from '@dcloudio/uni-app'
import { ref } from 'vue'

// È°µÈù¢ÈÖçÁΩÆ
definePage({
  style: {
    navigationStyle: 'custom',
    navigationBarTitleText: 'ÈóÆËØäÈ¢ÑÁ∫¶',
  },
})

// ÂåªÁîü‰ø°ÊÅØÊï∞ÊçÆÔºàÂç†‰ΩçÁî®Ôºâ
const doctorsData = [
  {
    id: '1',
    name: 'Â≠ôÂåªÁîü',
    avatar: 'https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?w=400&h=400&fit=crop&crop=center',
    department: 'È™®Áßë‰∏ìÂÆ∂',
    title: 'XXÁñóÊ≥ï‰º†Êâø‰∫∫',
    intro: 'Â∏à‰ªé‰∏≠ÂåªÈ™®ÁßëÊ≥∞ÊñóxxxÔºå‰ªéÂåª20Âπ¥ÔºåÊÇ£ËÄÖÂ•ΩËØÑÁéá99%ÔºåÊìÖÈïøÈíàÁÅ∏Ê≠£È™®„ÄÇ',
    personalStatement: '"ÁßâÊâøÁ•ñËÆ≠Ôºå‰∏ìÊîªÁñëÈöæÈ™®Áßë"',
    recommendationCount: null,
    consultationCount: 121,
    satisfaction: null,
    speed: 'ËæÉÂø´'
  },
  {
    id: '2',
    name: 'ÊùéÂåªÁîü',
    avatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400&h=400&fit=crop&crop=center',
    department: 'ÂÜÖÁßëÂåªÂ∏à',
    title: 'ÂâØ‰∏ª‰ªªÂåªÂ∏à',
    intro: 'ÊØï‰∏ö‰∫éxxxÂåªÁßëÂ§ßÂ≠¶Ôºå‰ªé‰∫ã‰∏¥Â∫äÂ∑•‰Ωú15Âπ¥ÔºåÊìÖÈïøÊ∂àÂåñÁ≥ªÁªüÁñæÁóÖËØäÊ≤ª„ÄÇ',
    personalStatement: '"‰ª•ÊÇ£ËÄÖ‰∏∫‰∏≠ÂøÉÔºåÁî®ÂøÉÊ≤ªÁñóÊØè‰∏Ä‰ΩçÁóÖ‰∫∫"',
    recommendationCount: 56,
    consultationCount: 234,
    satisfaction: '98%',
    speed: 'ÂæàÂø´'
  },
  {
    id: '3',
    name: 'Èü©ÂåªÁîü',
    avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=400&fit=crop&crop=center',
    department: '‰∏≠ÂåªÂ∏à',
    title: '‰∏ªÊ≤ªÂåªÂ∏à',
    intro: '‰ªéÂåª20‰ΩôÂπ¥ÔºåÊìÖÈïøÊ≤ªÁñóÂêÑÁ±ªÊÖ¢ÊÄßÁóÖÔºåÂ∞§ÂÖ∂Âú®ÂøÉË°ÄÁÆ°ÁñæÁóÖÈò≤Ê≤ªÊñπÈù¢ÊúâÊ∑±ÂÖ•Á†îÁ©∂„ÄÇ',
    personalStatement: '"‰∏≠ÂåªË∞ÉÁêÜÔºåÊ†áÊú¨ÂÖºÊ≤ª"',
    recommendationCount: 89,
    consultationCount: 937,
    satisfaction: '99.5%',
    speed: 'Âø´'
  }
]

// ÂΩìÂâçÊòæÁ§∫ÁöÑÂåªÁîü‰ø°ÊÅØ
const doctorInfo = ref(doctorsData[0])

// È¢ÑÁ∫¶ÊúçÂä°Á±ªÂûã
const appointmentServices = [
  {
    id: 'video',
    title: 'ËßÜÈ¢ëÊåÇÂè∑',
    description: 'ÁÅµÊ¥ªËßÜÈ¢ëÊó∂Èó¥',
    price: '¬•20',
    buttonText: 'ÂéªÊåÇÂè∑',
    color: 'bg-[#ff6b35]'
  },
  {
    id: 'text',
    title: 'ÂõæÊñáÈóÆËØä',
    description: 'ÂõæÊñáÂí®ËØ¢Ê≤üÈÄö',
    price: '¬•20/Ê¨°',
    buttonText: 'ÂéªÈóÆËØä',
    color: 'bg-[#ff6b35]',
    icon: 'üí¨'
  },
  {
    id: 'phone',
    title: 'ÁîµËØùÈóÆËØä',
    description: '13ÂàÜÈíüÁîµËØù‰∫§ÊµÅÔºå‰ªäÊó•Èôê3‰∏™Âè∑',
    price: '¬•20/10ÂàÜÈíü',
    buttonText: 'ÂéªÈÄöËØù',
    color: 'bg-[#5088ff]',
    icon: 'üìû',
    tag: 'Âè∑Ê∫êÂ∞ë'
  }
]

// ÁîüÂëΩÂë®Êúü
onLoad((options: { id?: string }) => {
  console.log('ÈóÆËØäÈ¢ÑÁ∫¶È°µÈù¢Âä†ËΩΩÔºåÂèÇÊï∞:', options)
  // Ê†πÊçÆ‰º†ÂÖ•ÁöÑÂåªÁîüIDËé∑ÂèñÂØπÂ∫îÁöÑÂåªÁîü‰ø°ÊÅØ
  if (options.id) {
    const doctor = doctorsData.find(d => d.id === options.id)
    if (doctor) {
      doctorInfo.value = doctor
    } else {
      console.log('Êú™ÊâæÂà∞ÂØπÂ∫îIDÁöÑÂåªÁîüÔºå‰ΩøÁî®ÈªòËÆ§ÂåªÁîü‰ø°ÊÅØ')
    }
  }
})

// Â§ÑÁêÜËøîÂõû
function handleBack() {
  uni.navigateBack()
}

// Â§ÑÁêÜÈ¢ÑÁ∫¶ÊúçÂä°ÁÇπÂáª
function handleServiceClick(service: typeof appointmentServices[0]) {
  console.log('ÈÄâÊã©È¢ÑÁ∫¶ÊúçÂä°:', service)
  // ÊâÄÊúâÊåâÈíÆÈÉΩË∑≥ËΩ¨Âà∞ÊîØ‰ªòÈ°µÈù¢
  uni.navigateTo({
    url: `/pages/normal/online-consultation/payment?id=${doctorInfo.value.id}&serviceId=${service.id}`,
    success: () => {
      console.log('Ë∑≥ËΩ¨Âà∞ÊîØ‰ªòÈ°µÈù¢ÊàêÂäü')
    },
    fail: (err) => {
      console.error('Ë∑≥ËΩ¨Âà∞ÊîØ‰ªòÈ°µÈù¢Â§±Ë¥•:', err)
    }
  })
}
</script>

<template>
  <view class="bg-[#f5f5f5] min-h-screen">
    <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
    <view class="sticky top-0 z-10 flex items-center justify-between bg-white px-4 py-3 border-b border-[#eee]">
      <view class="flex items-center">
        <text class="mr-2 text-[#333] text-[36rpx]" @click="handleBack">‚Üê</text>
        <text class="text-[#333] font-medium text-[32rpx]">ÈóÆËØäÈ¢ÑÁ∫¶</text>
      </view>
    </view>

    <!-- ÂåªÁîü‰ø°ÊÅØÂç°Áâá -->
    <view class="mb-3 bg-white p-4">
      <view class="flex items-start">
        <!-- ÂåªÁîüÂ§¥ÂÉè -->
        <image :src="doctorInfo.avatar" class="mr-3 h-24 w-24 flex-shrink-0 rounded-full" />
        
        <!-- ÂåªÁîüÂü∫Êú¨‰ø°ÊÅØ -->
        <view class="flex-1">
          <view class="mb-1 flex items-center">
            <text class="mr-2 text-[#333] font-medium text-[28rpx]">{{ doctorInfo.name }}</text>
            <text class="text-[#666] text-[24rpx]">{{ doctorInfo.department }}</text>
          </view>
          <text class="mb-2 block text-[#666] text-[24rpx]">{{ doctorInfo.title }}</text>
          <text class="mb-2 block line-clamp-2 text-[#999] text-[24rpx]">{{ doctorInfo.intro }}</text>
          <text class="block text-[#999] text-[24rpx]">{{ doctorInfo.personalStatement }}</text>
        </view>
      </view>

      <!-- ÁªüËÆ°‰ø°ÊÅØ -->
      <view class="mt-4 grid grid-cols-4 gap-2 border-t border-[#eee] pt-3">
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">
            {{ doctorInfo.recommendationCount || 'ÊöÇÊó†' }}
          </text>
          <text class="text-[#999] text-[20rpx]">ÊÇ£ËÄÖÊé®Ëçê</text>
        </view>
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">{{ doctorInfo.consultationCount }}</text>
          <text class="text-[#999] text-[20rpx]">Êé•ËØä‰∫∫Ê¨°</text>
        </view>
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">
            {{ doctorInfo.satisfaction || 'ÊöÇÊó†' }}
          </text>
          <text class="text-[#999] text-[20rpx]">Êª°ÊÑèÂ∫¶</text>
        </view>
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">{{ doctorInfo.speed }}</text>
          <text class="text-[#999] text-[20rpx]">Êé•ËØäÈÄüÂ∫¶</text>
        </view>
      </view>
    </view>

    <!-- È¢ÑÁ∫¶ÊúçÂä°ÂàóË°® -->
    <view class="space-y-3 bg-white px-4 py-3">
      <view v-for="service in appointmentServices" :key="service.id" class="mb-4">
        <text class="mb-2 block text-[#333] font-medium text-[28rpx]">{{ service.title }}</text>
        <view class="flex items-center justify-between rounded-[8rpx] border border-[#eee] px-4 py-3">
          <view class="flex items-center">
            <!-- ÊúçÂä°ÂõæÊ†áÔºàÂ¶ÇÊûúÊúâÔºâ -->
            <text v-if="service.icon" class="mr-3 text-[36rpx]">{{ service.icon }}</text>
            <text class="text-[#666] text-[24rpx]">{{ service.description }}</text>
          </view>
          <view class="flex items-center">
            <!-- ‰ª∑Ê†º -->
            <text class="mr-3 text-[24rpx]" :class="service.color === 'bg-[#5088ff]' ? 'text-[#5088ff]' : 'text-[#ff6b35]'">
              {{ service.price }}
            </text>
            <!-- Ê†áÁ≠æ -->
            <view v-if="service.tag" class="mr-3 rounded-[4rpx] bg-[#ffebe5] px-2 py-0.5 text-[#ff6b35] text-[18rpx]">
              {{ service.tag }}
            </view>
            <!-- ÊåâÈíÆ -->
            <view class="rounded-[4rpx] w-[120rpx] min-w-[120rpx] text-center px-0 py-1.5 text-white text-[24rpx]" :class="service.color" @click="handleServiceClick(service)">
              {{ service.buttonText }}
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>