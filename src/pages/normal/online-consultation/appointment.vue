<script setup lang="ts">
// é—®è¯Šé¢„çº¦é¡µé¢
import { onLoad } from '@dcloudio/uni-app'
import { ref } from 'vue'

// é¡µé¢é…ç½®
definePage({
  style: {
    navigationStyle: 'custom',
    navigationBarTitleText: 'é—®è¯Šé¢„çº¦',
  },
})

// åŒ»ç”Ÿä¿¡æ¯æ•°æ®ï¼ˆå ä½ç”¨ï¼‰
const doctorsData = [
  {
    id: '1',
    name: 'å­™åŒ»ç”Ÿ',
    avatar: 'https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?w=400&h=400&fit=crop&crop=center',
    department: 'éª¨ç§‘ä¸“å®¶',
    title: 'XXç–—æ³•ä¼ æ‰¿äºº',
    intro: 'å¸ˆä»ä¸­åŒ»éª¨ç§‘æ³°æ–—xxxï¼Œä»åŒ»20å¹´ï¼Œæ‚£è€…å¥½è¯„ç‡99%ï¼Œæ“…é•¿é’ˆç¸æ­£éª¨ã€‚',
    personalStatement: '"ç§‰æ‰¿ç¥–è®­ï¼Œä¸“æ”»ç–‘éš¾éª¨ç§‘"',
    recommendationCount: null,
    consultationCount: 121,
    satisfaction: null,
    speed: 'è¾ƒå¿«'
  },
  {
    id: '2',
    name: 'æåŒ»ç”Ÿ',
    avatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400&h=400&fit=crop&crop=center',
    department: 'å†…ç§‘åŒ»å¸ˆ',
    title: 'å‰¯ä¸»ä»»åŒ»å¸ˆ',
    intro: 'æ¯•ä¸šäºxxxåŒ»ç§‘å¤§å­¦ï¼Œä»äº‹ä¸´åºŠå·¥ä½œ15å¹´ï¼Œæ“…é•¿æ¶ˆåŒ–ç³»ç»Ÿç–¾ç—…è¯Šæ²»ã€‚',
    personalStatement: '"ä»¥æ‚£è€…ä¸ºä¸­å¿ƒï¼Œç”¨å¿ƒæ²»ç–—æ¯ä¸€ä½ç—…äºº"',
    recommendationCount: 56,
    consultationCount: 234,
    satisfaction: '98%',
    speed: 'å¾ˆå¿«'
  },
  {
    id: '3',
    name: 'éŸ©åŒ»ç”Ÿ',
    avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=400&fit=crop&crop=center',
    department: 'ä¸­åŒ»å¸ˆ',
    title: 'ä¸»æ²»åŒ»å¸ˆ',
    intro: 'ä»åŒ»20ä½™å¹´ï¼Œæ“…é•¿æ²»ç–—å„ç±»æ…¢æ€§ç—…ï¼Œå°¤å…¶åœ¨å¿ƒè¡€ç®¡ç–¾ç—…é˜²æ²»æ–¹é¢æœ‰æ·±å…¥ç ”ç©¶ã€‚',
    personalStatement: '"ä¸­åŒ»è°ƒç†ï¼Œæ ‡æœ¬å…¼æ²»"',
    recommendationCount: 89,
    consultationCount: 937,
    satisfaction: '99.5%',
    speed: 'å¿«'
  }
]

// å½“å‰æ˜¾ç¤ºçš„åŒ»ç”Ÿä¿¡æ¯
const doctorInfo = ref(doctorsData[0])

// é¢„çº¦æœåŠ¡ç±»å‹
const appointmentServices = [
  {
    id: 'video',
    title: 'è§†é¢‘æŒ‚å·',
    description: 'çµæ´»è§†é¢‘æ—¶é—´',
    price: 'Â¥20',
    buttonText: 'å»æŒ‚å·',
    color: 'bg-[#ff6b35]'
  },
  {
    id: 'text',
    title: 'å›¾æ–‡é—®è¯Š',
    description: 'å›¾æ–‡å’¨è¯¢æ²Ÿé€š',
    price: 'Â¥20/æ¬¡',
    buttonText: 'å»é—®è¯Š',
    color: 'bg-[#ff6b35]',
    icon: 'ğŸ’¬'
  },
  {
    id: 'phone',
    title: 'ç”µè¯é—®è¯Š',
    description: '13åˆ†é’Ÿç”µè¯äº¤æµï¼Œä»Šæ—¥é™3ä¸ªå·',
    price: 'Â¥20/10åˆ†é’Ÿ',
    buttonText: 'å»é€šè¯',
    color: 'bg-[#5088ff]',
    icon: 'ğŸ“',
    tag: 'å·æºå°‘'
  }
]

// ç”Ÿå‘½å‘¨æœŸ
onLoad((options: { id?: string }) => {
  console.log('é—®è¯Šé¢„çº¦é¡µé¢åŠ è½½ï¼Œå‚æ•°:', options)
  // æ ¹æ®ä¼ å…¥çš„åŒ»ç”ŸIDè·å–å¯¹åº”çš„åŒ»ç”Ÿä¿¡æ¯
  if (options.id) {
    const doctor = doctorsData.find(d => d.id === options.id)
    if (doctor) {
      doctorInfo.value = doctor
    } else {
      console.log('æœªæ‰¾åˆ°å¯¹åº”IDçš„åŒ»ç”Ÿï¼Œä½¿ç”¨é»˜è®¤åŒ»ç”Ÿä¿¡æ¯')
    }
  }
})

// å¤„ç†è¿”å›
function handleBack() {
  uni.navigateBack()
}

// å¤„ç†é¢„çº¦æœåŠ¡ç‚¹å‡»
function handleServiceClick(service: { id: string }) {
  console.log('ç‚¹å‡»é¢„çº¦æœåŠ¡:', service.id)
  
  // æ ¹æ®æœåŠ¡IDç¡®å®šæœåŠ¡ç±»å‹
  let serviceTypeName = ''
  if (service.id === 'video') {
    serviceTypeName = 'è§†é¢‘é—®è¯Š'
  } else if (service.id === 'text') {
    serviceTypeName = 'å›¾æ–‡é—®è¯Š'
  } else if (service.id === 'phone') {
    serviceTypeName = 'ç”µè¯é—®è¯Š'
  }
  
  // è·³è½¬åˆ°å€™è¯Šå®¤é¡µé¢ï¼Œå¹¶ä¼ é€’æœåŠ¡ç±»å‹
  uni.navigateTo({
    url: `/pages/normal/online-consultation/waiting-room?doctorId=${doctorInfo.value.id}&doctorName=${encodeURIComponent(doctorInfo.value.name)}&department=${encodeURIComponent(doctorInfo.value.department)}&avatar=${encodeURIComponent(doctorInfo.value.avatar)}&serviceType=${encodeURIComponent(serviceTypeName)}`
  })
}
</script>

<template>
  <view class="bg-[#f5f5f5] min-h-screen">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <view class="sticky top-0 z-10 flex items-center justify-between bg-white px-4 py-3 border-b border-[#eee]">
      <view class="flex items-center">
        <text class="mr-2 text-[#333] text-[36rpx]" @click="handleBack">â†</text>
        <text class="text-[#333] font-medium text-[32rpx]">é—®è¯Šé¢„çº¦</text>
      </view>
    </view>

    <!-- åŒ»ç”Ÿä¿¡æ¯å¡ç‰‡ -->
    <view class="mb-3 bg-white p-4">
      <view class="flex items-start">
        <!-- åŒ»ç”Ÿå¤´åƒ -->
        <image :src="doctorInfo.avatar" class="mr-3 h-24 w-24 flex-shrink-0 rounded-full" />
        
        <!-- åŒ»ç”ŸåŸºæœ¬ä¿¡æ¯ -->
        <view class="flex-1">
          <view class="mb-1 flex items-center">
            <text class="mr-2 text-[#333] font-medium text-[28rpx]">{{ doctorInfo.name }}</text>
            <text class="text-[#666] text-[24rpx]">{{ doctorInfo.department }}</text>
          </view>
          <text class="mb-2 block text-[#666] text-[24rpx]">{{ doctorInfo.title }}</text>
          <text class="mb-2 block line-clamp-2 text-[#999] text-[24rpx]">{{ doctorInfo.intro }}</text>
          <text class="block text-[#999] text-[24rpx]">{{ doctorInfo.personalStatement }}</text>
        </view>
      </view>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="mt-4 grid grid-cols-4 gap-2 border-t border-[#eee] pt-3">
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">
            {{ doctorInfo.recommendationCount || 'æš‚æ— ' }}
          </text>
          <text class="text-[#999] text-[20rpx]">æ‚£è€…æ¨è</text>
        </view>
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">{{ doctorInfo.consultationCount }}</text>
          <text class="text-[#999] text-[20rpx]">æ¥è¯Šäººæ¬¡</text>
        </view>
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">
            {{ doctorInfo.satisfaction || 'æš‚æ— ' }}
          </text>
          <text class="text-[#999] text-[20rpx]">æ»¡æ„åº¦</text>
        </view>
        <view class="text-center">
          <text class="block text-[#666] text-[24rpx]">{{ doctorInfo.speed }}</text>
          <text class="text-[#999] text-[20rpx]">æ¥è¯Šé€Ÿåº¦</text>
        </view>
      </view>
    </view>

    <!-- é¢„çº¦æœåŠ¡åˆ—è¡¨ -->
    <view class="space-y-3 bg-white px-4 py-3">
      <view v-for="service in appointmentServices" :key="service.id" class="mb-4">
        <text class="mb-2 block text-[#333] font-medium text-[28rpx]">{{ service.title }}</text>
        <view class="flex items-center justify-between rounded-[8rpx] border border-[#eee] px-4 py-3">
          <view class="flex items-center">
            <!-- æœåŠ¡å›¾æ ‡ï¼ˆå¦‚æœæœ‰ï¼‰ -->
            <text v-if="service.icon" class="mr-3 text-[36rpx]">{{ service.icon }}</text>
            <text class="text-[#666] text-[24rpx]">{{ service.description }}</text>
          </view>
          <view class="flex items-center">
            <!-- ä»·æ ¼ -->
            <text class="mr-3 text-[24rpx]" :class="service.color === 'bg-[#5088ff]' ? 'text-[#5088ff]' : 'text-[#ff6b35]'">
              {{ service.price }}
            </text>
            <!-- æ ‡ç­¾ -->
            <view v-if="service.tag" class="mr-3 rounded-[4rpx] bg-[#ffebe5] px-2 py-0.5 text-[#ff6b35] text-[18rpx]">
              {{ service.tag }}
            </view>
            <!-- æŒ‰é’® -->
            <view class="rounded-[4rpx] w-[120rpx] min-w-[120rpx] text-center px-0 py-1.5 text-white text-[24rpx]" :class="service.color" @click="handleServiceClick(service)">
              {{ service.buttonText }}
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>